<html>

<head>
    <title> Prosody - Playing </title>
    <link rel="shortcut icon" type="image/png" href="Sprites/Icon.png" />
    <link rel="stylesheet" href="CSS/Modal.css">
    <link rel="stylesheet" href="CSS/UI.css">
    <link rel="stylesheet" href="CSS/NoSelect.css">
    <script src="Scripts/IframeAutoFitter.js"></script>
    <style>
        .note {
            position: absolute;
            width: 8rem;
            pointer-events: none;
        }
        
        .hitter {
            position: inherit;
            width: 8rem;
            height: 8rem;
            top: 0;
        }
        
        .hitError {
            position: inherit;
            width: 0.25rem;
            height: 0.9375rem;
            top: -0.3125rem;
            border-radius: 0.3125rem;
            opacity: 0.825;
        }
    </style>
</head>

<body>
    <script src="Scripts/antiContext.js"></script>
    <script src="Scripts/note.js"></script>
    <script src="Scripts/chart.js"></script>
    <script src="Scripts/savingAndLoading.js"></script>
    <script src="Scripts/statCalculations.js"></script>
    <script src="Scripts/noteRenderer.js"></script>
    <script src="Scripts/hitError.js"></script>
    <script src="Scripts/hitCheck.js"></script>
    <script src="Scripts/showLetters.js"></script>
    <script>
        chart = null; // The chart itself
        chartData = null; // Gets map data from location
        chartMetaData = null; // Chart name and stuff the user would see

        siteLoaded = false; // Makes sure the site is loaded before user can do anything
        playing = false; // Chart playing or not
        audio = null; // Music

        /*Modifiers*/
        scrollSpeed = 15; // VISUAL: how fast the notes go by
        auto = false; // The game plays itself
        rate = 1; // How fast the map plays
        hitRange = 0.416666666667; // Judgement range of notes

        /*Input & Notes*/
        hitKeys = [68, 70, 74, 75]; // Key bindings for gameplay
        StartPos = [0, 0] // Where the notes heading
        notes = []; // List of all the visual note objects
        hitters = []; // List of the hittters
        key = [false, false, false, false]; // Whether key is held or not
        keys = [false, false, false, false]; // Whether key is just pressed or not
        released = [true, true, true, true]; // Whether key has been released after last press
        idProgress = [0, 0, 0, 0]; // Progress of notes for notelock
        releasedIdProgress = [0, 0, 0, 0]; // Release progress of notes for notelock that only changes after key released
        input = null; // For Detection
        inputBox = null; // For Detection
        inputIndex = null; // For Detection
        waitingForInput = false; // For Detection, or possibly other uses

        /*Score Calculation*/
        Judgements = [0, 0, 0, 0, 0];
        JudgementWeights = [1, 1.010101, 1.111111, 1.5, 3];
        JudgementRanges = [32, 8, 4, 1];
        Combos = [0, 0, 0]; // P+, Perfect, Full combo
        HighestCombos = [0, 0, 0]; // P+, Perfect, Full combo

        /*Settings*/
        HitErrorTime = 1000; // How long until Hit Errors fade completely

        /*Misc & Results*/
        exited = false
        tempNoteId = 0
        hitErrors = [];
        rotation = [0, 0, 0, 0];
        rotateProgress = 0
        pause = [true, false, 0] // Can pause, Is paused, Paused amount
        StartTime = null;
        totalNotes = 0;
        //FinalNoteTime = null;

        function LoadChart(_chart) {
            try { // TFGo avoid error 
                _chartJSON = JSON.parse(_chart);
            } catch (error) {
                console.error("Invalid chart or map!\n" + error);
                return;
            }

            console.log(localStorage["Difficulty"])
            return new Chart(_chartJSON, localStorage["Difficulty"], 4, StartPos[0], StartPos[1], 0, 1, 0, rate); // Creates the chart that will be played or is being viewed
        }

        // Removes next note in row
        function RemoveNote(_row) {
            chart.Remove(_row); // Removes the note behind the scene
            let _removedNote = notes[_row].pop(); // Removes visual note from the notes array and gets that same visual object
            _removedNote.remove() // Removes the visual note

            idProgress[_row]++; // Increases idProgress so next note in row can be hit
        }

        function InitChart(_chartData) {
            chart = LoadChart(_chartData);
            chartMetaData = chart.Get_MetaData(); // Things like chart name, creator, etc.
            notes = InitNotes(chart, notes) // Create original note objects and assigns them to the note var

            document.getElementById("BGGradient").src = _chartJSON["BG"]["Gradient"];
            document.getElementById("BGPattern").src = _chartJSON["BG"]["Pattern"];
            document.getElementById("BGCenter").src = _chartJSON["BG"]["Center"];

            totalNotes = chart.map["4Rows"][localStorage["Difficulty"]]["Notes"][0].length + chart.map["4Rows"][localStorage["Difficulty"]]["Notes"][1].length + chart.map["4Rows"][localStorage["Difficulty"]]["Notes"][2].length + chart.map["4Rows"][localStorage["Difficulty"]]["Notes"][3].length
        }

        function Start(chartData, mapId) {
            InitChart(chartData, mapId)
            console.log("Map: " + mapId + " - " + chartMetaData);
        }

        function KeyDown(_index) {
            key[_index] = true
            hitters[_index].src = "Sprites/Notes/Hitter_Lit_1.png";

            if (released[_index] == true) {
                keys[_index] = true
                released[_index] = false;
            }
            setTimeout(function() {
                keys[_index] = false
            }, 1000 / 120);
        }

        function KeyUp(_index) {
            key[_index] = false;
            hitters[_index].src = "Sprites/Notes/Hitter_Unlit_1.png";

            released[_index] = true;
            releasedIdProgress[_index] = idProgress[_index];
        }

        function Pause() {
            pause[0] = false;
            pause[1] = true;
            pause[2]++;
            chart.Pause();
        }

        function Resume() {
            pause[1] = false;
            chart.Resume()
        }

        window.onkeydown = function(e) {
            if (siteLoaded) {
                if (waitingForInput) {
                    Set_Input_Key(e.keyCode);
                }
                switch (e.keyCode) {
                    case hitKeys[0]:
                        if (!pause[1] & !auto) {
                            KeyDown(0);
                        }
                        break;
                    case hitKeys[1]:
                        if (!pause[1] & !auto) {
                            KeyDown(1);
                        }
                        break;
                    case hitKeys[2]:
                        if (!pause[1] & !auto) {
                            KeyDown(2);
                        }
                        break;
                    case hitKeys[3]:
                        if (!pause[1] & !auto) {
                            KeyDown(3);
                        }
                        break;

                    case 32: // START MAP
                        if (!playing) {
                            StartTime = Date.now();
                            startMap();
                            for (let i = 0; i < hitKeys.length; i++) {
                                const letter = String.fromCharCode(hitKeys[i]);
                                showLetter(letter, 'Arial', window.innerWidth / 1920 * 42, window.innerWidth / 1920 * 800 + (i * 96), window.innerWidth / 1920 * 720, 1000, 10000, true, 1000);
                            }
                        }
                        break;

                    case 27: // Pause & Exit
                        if (pause[0] && playing) {
                            Pause(true)
                            document.body.style.cursor = 'initial';
                            document.getElementById("PauseMenu").style.display = "block";
                            return;
                        }
                        if (!playing) {
                            location.href = 'menu.html';
                        }
                        break
                    case 192: // RESTART MAP
                        Reload_Chart()
                        break;

                    default:
                        console.log(e.keyCode)
                        break;
                }
                setTimeout(() => {
                    if (Judgements[0] + Judgements[1] + Judgements[2] + Judgements[3] + Judgements[4] == totalNotes && playing == true) {
                        Show_Results()
                    }
                }, 500);
            }
        }

        window.onkeyup = function(e) {
            if (siteLoaded) {
                switch (e.keyCode) {
                    case hitKeys[0]:
                        KeyUp(0);
                        break;
                    case hitKeys[1]:
                        KeyUp(1);
                        break;
                    case hitKeys[2]:
                        KeyUp(2);
                        break;
                    case hitKeys[3]:
                        KeyUp(3);
                        break;

                    default:
                        break;
                }
            }
        }

        function Set_Score_Rank_Image() {
            document.getElementById("ResultRankScore").src = "Sprites/Ranks/Rank_F.png"
            if (Get_Acc(Judgements, JudgementWeights) < 0.7) return;

            document.getElementById("ResultRankScore").src = "Sprites/Ranks/Rank_C.png"
            if (Judgements[4] != 0) return;

            if (Judgements[3] == 0) {
                if (Judgements[2] == 0) {
                    if (Judgements[1] == 0) {
                        document.getElementById("ResultRankScore").src = "Sprites/Ranks/Rank_PC+.png"
                        return;
                    }
                    document.getElementById("ResultRankScore").src = "Sprites/Ranks/Rank_PC.png"
                    return;
                }
                document.getElementById("ResultRankScore").src = "Sprites/Ranks/Rank_FC.png"
                return;
            }
            document.getElementById("ResultRankScore").src = "Sprites/Ranks/Rank_C.png"
        }

        function Set_Acc_Rank_Image() {
            const _acc = Get_Acc(Judgements, JudgementWeights);

            document.getElementById("ResultRankAcc").src = "Sprites/Ranks/Rank_F.png"
            if (_acc < 0.7) return;

            document.getElementById("ResultRankAcc").src = "Sprites/Ranks/Rank_C.png"
            if (_acc < 0.8) return;

            document.getElementById("ResultRankAcc").src = "Sprites/Ranks/Rank_B.png"
            if (_acc < 0.9) return;

            document.getElementById("ResultRankAcc").src = "Sprites/Ranks/Rank_A.png"
            if (_acc < 0.95) return;

            document.getElementById("ResultRankAcc").src = "Sprites/Ranks/Rank_S.png"
            if (_acc < 1) return;

            if (_acc == 1) document.getElementById("ResultRankAcc").src = "Sprites/Ranks/Rank_EX.png";
        }

        function Show_Results() {
            document.body.style.cursor = 'initial';
            console.log("Setting Results")
            playing = false;
            console.log("Ending Play");
            document.getElementById("StatsMenu").style.display = "block";
            console.log("Showing Results");
            document.getElementById("PauseMenu").style.display = "none";
            document.getElementById("ResultPPAmount").innerText = Judgements[0] + " (x" + HighestCombos[0] + ")";
            console.log("Showing Judgement & Combo Results");
            document.getElementById("ResultPAmount").innerText = Judgements[1] + " (x" + HighestCombos[1] + ")";
            document.getElementById("ResultGAmount").innerText = Judgements[2] + " (x" + HighestCombos[2] + ")";
            document.getElementById("ResultBAmount").innerText = Judgements[3];
            document.getElementById("ResultMAmount").innerText = Judgements[4];

            document.getElementById("ResultMapName").innerText = `${chartMetaData[0]}`;
            document.getElementById("ResultArtist").innerText = `Artist: ${chartMetaData[1]}`;
            document.getElementById("ResultCreator").innerText = `Creator: ${chartMetaData[2]}`;
            document.getElementById("ResultDiff").innerText = `Difficulty [${chartMetaData[4]} (${Math.round(calculateDifficulty(chart.map, localStorage["Difficulty"], chart.rate)*1000)/1000})`;
            var _date = new Date()
            document.getElementById("ResultDate").innerText = `Date: ${_date.getHours()}:${_date.getMinutes()}:${_date.getSeconds()} - ${_date.getDay()}/${_date.getMonth()}/${_date.getFullYear()}`;

            document.getElementById("ResultScore").innerText = Math.round(Get_Score(Judgements, JudgementWeights, HighestCombos));
            console.log("Showing Score Results");
            document.getElementById("ResultAcc").innerText = Math.round(Get_Acc(Judgements, JudgementWeights) * 100000) / 1000 + "%";
            console.log("Showing Acc Results");
            document.getElementById("ResultValue").innerText = Math.round(Get_Value(Judgements, JudgementWeights, HighestCombos, chart.map, localStorage["Difficulty"], rate) * 100) / 100;
            console.log("Showing Value Results");

            document.getElementById("ResultAuto").innerText = document.getElementById("OptionModAuto").checked;
            console.log("Showing Mods");
            document.getElementById("ResultRate").innerText = "x" + document.getElementById("OptionModRate").value;
            document.getElementById("ResultSwitcher").innerText = document.getElementById("OptionSwitcher").checked;

            console.log("Base Results Done");

            Create_Result_Hit_Errors();
            console.log("Showing Hit Error Results");
            pause = [true, false, 0]

            Set_Score_Rank_Image()
            Set_Acc_Rank_Image()
        }


        // When site loads
        window.onload = function() {
            LoadSettings() // Loads settings if they were saved

            //Map data retrieval
            //document.getElementById("OptionChartData").innerHTML = localStorage["Chart"];


            // Makes sure the map doesn't go too far offscreen
            if (document.getElementById("OptionPlayfieldXOffset").value > 100) {
                document.getElementById("OptionPlayfieldXOffset").value = 46.9;
            }

            // Updates the game, basically the play
            function Update(_chart) {
                HitCheck()
                UpdateNotes(chart); // Update the notes position the user will see onscreen
                if (playing) { // Checks if chart is playing or not
                    if (chart.Get_Audio_Time_Left() <= 0) {
                        Show_Results()
                    }
                    chart.Update_Progress(rate); // Updates note behind the scene based on song position
                    for (let i = 0; i < hitters.length; i++) {
                        const element = hitters[i];
                        element.innerHTML = key[i] + " " + idProgress[i] + "<br>" + keys[i] + " " + releasedIdProgress[i];
                    }
                    //lastUpdate = Date.now() // Sets start date for delta time calculation
                    if (document.getElementById("OptionSwitcher").checked) {
                        if (Math.round(chart.progress) % 2 == 0) {
                            document.getElementById("OptionUpscroll").checked = true;
                            UpdateScrollDirection();
                        } else {
                            document.getElementById("OptionUpscroll").checked = false;
                            UpdateScrollDirection();
                        }
                    }
                }

                try {
                    progress = (chart.audio.currentTime / chart.audio.duration) * 100;
                    document.getElementById("ProgressBar").style.width = progress + '%';
                } catch (error) {}
            }
            for (let i = 0; i < document.getElementsByClassName("hitter").length; i++) {
                const element = document.getElementsByClassName("hitter")[i];
                hitters[i] = element;
            }
            Reload_Chart(); // First reload to avoid errors

            //document.getElementById("AccText").innerHTML = `&lt;Space to Start&gt;\n${calculateDifficulty(chart.map, rate)}`;
            setInterval(Update, 1000 / 240)
            siteLoaded = true;
        }

        function startMap() {
            document.body.style.cursor = 'none';
            document.getElementById('MainPanel').style.display = 'none'

            auto = document.getElementById("OptionModAuto").checked; // Check if auto mod is active

            playing = true; // For the update function to know it can start
            chart.Play_Audio(rate) // Starts the song

            document.getElementById("MapsSettingContainer").classList.add("delay-1", "UIHidingRight");
            //document.getElementById("ScoreBoard").classList.add("delay-1", "UIHidingLeft");
        }

        function Set_Input_Key(input) {
            waitingForInput = false;
            inputBox.value = input
            hitKeys[inputIndex - 1] = input;
        }

        function Set_Input_Box(index) {
            waitingForInput = true;
            inputBox = document.getElementById("KeyCheck" + index);
            inputBox.value = null;
            inputIndex = index;
        }

        function Reload_Chart(_object = null, _playing = false) {

            clearInterval(0); // Stops Update from being called every ms
            playing = false; // Keeps Update function from doing anything just incase
            pause = [true, false, 0];
            if (chart != null) { // Makes sure thare IS audio that can be disable
                clearInterval(chart.delayTimer); //chart.delayTimer
                chart.Stop_Audio(); // Stops the music from playing
            }
            if (_object != null) {
                _object.blur()
            }

            SaveOptions(); // Gets and Sets the Options
            document.body.style.cursor = 'initial';
            document.getElementById('MainPanel').style.display = (_playing) ? 'none' : 'block';
            document.getElementById("ComboText").innerHTML = ""; // Visual so people know how to start
            document.getElementById("StatsMenu").style.display = "none"; // Hides result screen
            document.getElementById("PauseMenu").style.display = "none"; // Hides result screen

            //document.getElementById("MapsSettingContainer").classList.remove("UIHidingRight");
            //document.getElementById("ScoreBoard").classList.remove("UIHidingLeft");

            // Removes ALL Notes
            for (let i = 0; i < notes.length; i++) {
                for (let j = 0; j < notes[i].length; j++) {
                    RemoveNote(i, 0)
                }
            }

            // Removes All Visual Notes
            while (document.getElementById("NoteContainer").children.length > 0) {
                document.getElementById("NoteContainer").children[0].remove();
            }

            // Removes all hit errors in results menu
            _delete = document.getElementById("ResultErrorContainer").children;
            while (_delete.length > 0) {
                _delete[0].remove();
            }

            while (hitErrors.length > 0) {
                hitErrors.pop(0);
            }

            // Now that all notes are go, notelock gets reset.
            for (let i = 0; i < idProgress.length; i++) {
                idProgress[i] = 0;
                releasedIdProgress[i] = 0;
            }

            // Resets play information
            Judgements = [0, 0, 0, 0, 0];
            Combos = [0, 0, 0];
            HighestCombos = [0, 0, 0];

            // For map Changes
            chartData = localStorage["Chart"];;
            rate = document.getElementById("OptionModRate").value; // Rate changes require whole map to be reload hence thiss function exists
            chart = null // So chart can be set later and so the previous doesn't interfere with anything
            Start(chartData, 1); // Generates the map
            document.title = `Prosody - Playing: ${chartMetaData[0]}`
            document.getElementById("AccText").innerHTML = `Space to Start`; // Visual so people know how to start // \n${calculateDifficulty(chart.map, rate)}

            Resize()
            playing = _playing;

        }

        function UpdateScrollDirection() {
            scrollSpeed = Math.abs(document.getElementById("OptionScrollSpeed").value) * (document.getElementById("OptionUpscroll").checked ? -1 : 1);
            document.getElementById("ChartContainer").style.left = document.getElementById("OptionPlayfieldXOffset").value + "rem";

            localStorage['ScrollSpeed'] = scrollSpeed;

            array = document.getElementsByClassName("hitter")
            if (document.getElementById("OptionUpscroll").checked) {
                for (let i = 0; i < array.length; i++) {
                    const element = array[i];
                    element.style.top = ""
                }
                StartPos[1] = 0
            } else {
                let s = 58 * window.innerHeight / 1080 // rem location of visual hitters || *16 is location of notes to be hit
                for (let i = 0; i < array.length; i++) {
                    const element = array[i];
                    element.style.top = s + "rem"
                }
                StartPos[1] = -s * 16
            }
        }

        function Resize() {
            UpdateScrollDirection()
            const windowWidth = window.innerWidth / 1920
            document.getElementById("ChartContainer").style.left = document.getElementById("OptionPlayfieldXOffset").value * windowWidth + "rem"
            document.getElementById("ChartContainer").style.width = 26.75 * windowWidth + "rem"
            document.getElementById("HitErrorBar").style.left = 6 * windowWidth + "rem"
            document.getElementById("HitErrorBar").style.width = 15 * windowWidth + "rem"
            document.getElementById("HitErrorBarExtension").style.left = 6.66 * windowWidth + "rem"
            document.getElementById("HitErrorBarExtension").style.width = windowWidth + "rem"
            for (let i = 0; i < hitters.length; i++) {
                const _hit = hitters[i];
                _hit.style.left = (6 * i) * windowWidth + "rem"
                _hit.style.width = 8 * windowWidth + "rem"
                _hit.style.height = _hit.style.width
                    //hitters[i] = _hit
            }
        }

        window.onresize = function() {
            Resize()
        }
    </script>

    <script src="Scripts/DifficultyCalculator.js"></script>
    <div id="PauseMenu" class="modal">
        <div class="modal-content">
            <p style="font-size: x-large;">Pause Menu</p>
            <div class="UIContainer" style="width: 97.5%;">
                <button onclick="{
                        document.getElementById('PauseMenu').style.display = 'none';
                        document.body.style.cursor = 'none';
                        setTimeout(function() {
                            Resume();
                            setTimeout(function() {
                                pause[0] = true;
                            }, 3000)
                        }, 1000)
                    }" style="width: 5rem; height: 3rem;">
                        Resume
                    </button>
                <button onclick="Reload_Chart()" style="width: 5rem; height: 3rem;">
                        Restart
                    </button>
                <button onclick="{window.location.href='menu.html'}" style="width: 5rem; height: 3rem;">
                        Exit
                    </button>

            </div>
        </div>
    </div>
    <div id="StatsMenu" class="modal">
        <div class="modal-content">
            <p style="font-size: x-large;">Results Menu</p>
            <div id="MapName" style="display:flex">
                <div id="ResultMapName" class="UIContainer" style="flex-direction: column; display: flex; align-items: center;">
                    Map Name
                </div>
            </div>
            <div id="MapMetaData" class="UIContainer" style="display:flex">
                <div id="ResultArtist" class="UIContainer" style="flex-direction: column; display: flex; align-items: center;">
                    Artist: Inaji
                </div>
                <div id="ResultCreator" class="UIContainer" style="flex-direction: column; display: flex; align-items: center;">
                    Creator: Cyphe Mercury
                </div>
                <div id="ResultDiff" class="UIContainer" style="flex-direction: column; display: flex; align-items: center;">
                    Difficulty: [Test Diff]
                </div>
                <div id="ResultDate" class="UIContainer" style="flex-direction: column; display: flex; align-items: center;">
                    Date: Today, Now
                </div>
            </div>
            <div id="ResultsSScoreContainer" style="display:flex">
                <div class="UIContainer" style="flex-direction: column; display: flex; align-items: center;">
                    <a>Score: </a><a id="ResultScore">0</a>
                    <div class="UIContainer">
                        <img id="ResultRankScore" src="Sprites/Ranks/Rank_FC.png" style="width: 10rem; margin: 5%; " />
                    </div>
                </div>
                <div class="UIContainer" style="flex-direction: column; display: flex; align-items: center;">
                    <a>Accuracy: </a><a id="ResultAcc">0</a>
                    <div class="UIContainer">
                        <img id="ResultRankAcc" src="Sprites/Ranks/Rank_EX.png" style="width: 10rem; margin: 5%; " />
                    </div>
                </div>
                <div class="UIContainer">
                    <a>Value: </a><a id="ResultValue">0</a>
                </div>
            </div>
            <div id="ResultsContainer" style="display:flex">
                <div class="UIContainer" style="max-width: 20%; display: flex;">
                    <div id="ResultData" style="float:left;width: 50%">
                        <p>Mods</p>
                        <div class="UIContainer">
                            <br>
                            <a>Auto - </a>
                            <a id="ResultAuto">False</a>
                            <br>
                            <a>Rate - </a>
                            <a id="ResultRate">x1.0</a>
                            <br>
                            <a>Swticher - </a>
                            <a id="ResultSwitcher">False</a>
                        </div>
                    </div>
                    <div id="ResultData" style="float:left;width: 50%">
                        <p>Judgements</p>
                        <div class="UIContainer">
                            <br>
                            <a>Perfect+ - </a>
                            <a id="ResultPPAmount">0</a>
                            <br>
                            <a>Prefect - </a>
                            <a id="ResultPAmount">0</a>
                            <br>
                            <a>Good - </a>
                            <a id="ResultGAmount">0</a>
                            <br>
                            <a>Bad - </a>
                            <a id="ResultBAmount">0</a>
                            <br>
                            <a>Miss - </a>
                            <a id="ResultMAmount">0</a>
                            <br>
                        </div>
                    </div>
                </div>
                <div class="UIContainer" style="max-width: 80%; height: 11.5rem;">
                    <div id="ResultError" style="float:left">
                        <div id="ResultHitErrorBar" style="position: relative; top: 2rem; width:0.3125rem; height: 8.3125rem; background-color: blue;">
                            <div id="ResultHitErrorBarExtension" style="position: inherit; top:4rem; left: 0rem; width:0.625rem; height: 0.325rem; background-color: blue;">
                            </div>
                        </div>
                    </div>
                    <div id="ResultError" style="float:right">
                        <div id="ResultHitErrorBar" style="position: relative; top: 2rem; width:0.3125rem; height: 8.3125rem; background-color: blue;">
                            <div id="ResultHitErrorBarExtension" style="position: inherit; top:4rem; left: -0.5rem; width:0.625rem; height: 0.325rem; background-color: blue;">
                            </div>
                        </div>
                    </div>
                    <div id="ResultErrorContainer" style="position:relative; width: 100%; height: 100%">
                    </div>
                </div>
            </div>
            <div class="UIContainer" style="width: 97.5%;">
                <button onclick="{Reload_Chart()}" style="width: 5rem; height: 3rem;">
                        Restart
                    </button>
            </div>
        </div>
    </div>
    <!-- End of modal HTML -->
    <div id="EverythingContainer">
        <!--<div id="ScoreBoard" class="UIContainer MainUIContainer" style="float:left; width:20%; max-width: 25%; height: 97%;">
            <div>
                <p>
                    SCORES (WIP)
                </p>
            </div>
            <div style="width:100%; height: 0.625rem;">

            </div>
            <div id="ScoreContainer" class="UIContainer">
                <div class="Score">
                    <img class="scorePFP" src="Sprites/Notes/Hitter_Unlit_1.png" />
                    <div>
                        <a>Test Score</a> <br>
                        <a>Test Score: 100%</a> <br>
                        <a>Date: 3/8/2023 11:35PM (GMT-8)</a> <br>
                    </div>
                </div>
            </div>
        </div>-->
        <div id="ChartContainer" style="position:absolute; width: 26.75rem; height: 120%; left: 46.8rem; top: -0.625rem; background-color: rgba(0, 0, 0, 0.4); border: 1px solid #888;">
            <div id="HitErrorBar" style="position: absolute; top:31.25rem; left: 9.0625rem; width:8.3125rem; height: 0.3125rem; background-color: blue;">
                <a id="ComboText" style="position: inherit; width: 4rem; left: 23rem; top: -3rem; background-color: rgba(0, 0, 0, 0.5); border-radius: 5px;"></a>
                <a id="AccText" style="position: inherit; width: 8rem; left: 23rem; top: -5rem; font-size: 16px; background-color: rgba(0, 0, 0, 0.5); border-radius: 5px;"></a>
                <!--<a id="ChartInfoText" style="position: inherit; width: 16rem; top: -3rem; text-align: center; font-size: 38px;">Loading...</a>-->
                <div id="HitErrorBarExtension" style="position: inherit; top:0; left: 4rem; width:0.325rem; height: 0.625rem; background-color: blue;">
                </div>
            </div>
            <div id="HitterContainer" style="position: absolute; width:100%;height:100%">
                <img id="Hitter1" class="hitter" src="Sprites/Notes/Hitter_Unlit_1.png" style="left: 0;"></img>
                <button style="position: absolute;top: 65%; left: 5%; height: 15%; width: 20%; background-color: rgba(0,0,0,0); border-color: rgba(0,0,0,0);" onmousedown="KeyDown(0)" onmouseup="KeyUp(0)"></button>
                <img id="Hitter2" class="hitter" src="Sprites/Notes/Hitter_Unlit_1.png" style="left: 6.25rem;"></img>
                <button style="position: absolute;top: 65%; left: 27%; height: 15%; width: 20%; background-color: rgba(0,0,0,0); border-color: rgba(0,0,0,0);" onmousedown="KeyDown(1)" onmouseup="KeyUp(1)"></button>
                <img id="Hitter3" class="hitter" src="Sprites/Notes/Hitter_Unlit_1.png" style="left: 12.5rem;"></img>
                <button style="position: absolute;top: 65%; left: 50%; height: 15%; width: 20%; background-color: rgba(0,0,0,0); border-color: rgba(0,0,0,0);" onmousedown="KeyDown(2)" onmouseup="KeyUp(2)"></button>
                <img id="Hitter4" class="hitter" src="Sprites/Notes/Hitter_Unlit_1.png" style="left: 18.75rem;"></img>
                <button style="position: absolute;top: 65%; left: 72%; height: 15%; width: 20%; background-color: rgba(0,0,0,0); border-color: rgba(0,0,0,0);" onmousedown="KeyDown(3)" onmouseup="KeyUp(3)"></button>
            </div>
            <div id="NoteContainer" style="overflow:hidden;"></div>
        </div>
        <div id="MainPanel" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; background-color: rgba(0, 0, 0, 0.5);">
            <div style="background-color: rgba(26, 55, 92, 0.5); position: absolute; width: 50%; height: 66%; left: 25%; top: 16.6%; border-radius: 10px; box-shadow: 15px;  text-align: center;">
                <!--<a style="width: 100%; height: auto; font-size: 48px; color: white;">
                    TITLE
                </a>-->
                <div id="Mods&Info" style="display: flex; justify-content: space-around; width: 100%; height: calc(100% - 40px); overflow-y: scroll;">
                    <div style="width: 45%; height: auto;">
                        <div class="UIContainer" style="text-align: left; background-color: rgba(35, 54, 75, 0.9); border-radius: 5px;">
                            <div style="text-align: center; font-size: 32px; color: white;">
                                <p>
                                    KEY BINDINGS
                                </p>
                            </div>
                            <hr>
                            <div id="KeyBindsContainer">
                                <div style="text-align: center;">
                                    <label>GAMEPLAY</label>
                                </div>
                                <br>
                                <div id="KeyKeybindsContainer" style="display: flex; justify-content: center;">
                                    <input id="KeyCheck1" type="number" onchange="{SaveOptions();}" style="visibility: hidden; width: 0; padding: 0; margin: 0;" value="68"> <input id="KeyLetter1" type="text" onchange="{document.getElementById('KeyCheck1').value = this.value.toUpperCase().charCodeAt(0); SaveOptions()}"
                                        maxlength="1" style="width:2.5rem" value="D">
                                    <input id="KeyCheck2" type="number" onchange="{SaveOptions();}" style="visibility: hidden; width: 0; padding: 0; margin: 0;" value="70"> <input id="KeyLetter2" type="text" onchange="{document.getElementById('KeyCheck2').value = this.value.toUpperCase().charCodeAt(0); SaveOptions()}"
                                        maxlength="1" style="width:2.5rem" value="F">
                                    <input id="KeyCheck3" type="number" onchange="{SaveOptions();}" style="visibility: hidden; width: 0; padding: 0; margin: 0;" value="74"> <input id="KeyLetter3" type="text" onchange="{document.getElementById('KeyCheck3').value = this.value.toUpperCase().charCodeAt(0); SaveOptions()}"
                                        maxlength="1" style="width:2.5rem" value="J">
                                    <input id="KeyCheck4" type="number" onchange="{SaveOptions();}" style="visibility: hidden; width: 0; padding: 0; margin: 0;" value="75"> <input id="KeyLetter4" type="text" onchange="{document.getElementById('KeyCheck4').value = this.value.toUpperCase().charCodeAt(0); SaveOptions()}"
                                        maxlength="1" style="width:2.5rem" value="K">
                                </div>
                                <br>
                                <div style="text-align: center;">
                                    <label>OTHER</label>
                                </div>
                                <div id="OtherKeybindsContainer" style="display: flex; flex-direction: column; align-items: center;">
                                    <div>
                                        <input id="KeyRestart" type="text" onchange="{document.getElementById('KeyCheck1').value = this.value.toUpperCase().charCodeAt(0); SaveOptions()}" maxlength="1" style="width:2.5rem; margin: auto;" value=" ">
                                        <label><b>Start Chart </b></label>
                                    </div>
                                    <div>
                                        <input id="KeyRestart" type="text" onchange="{document.getElementById('KeyCheck1').value = this.value.toUpperCase().charCodeAt(0); SaveOptions()}" maxlength="1" style="width:2.5rem; margin: auto;" value="`">
                                        <label><b>Quick restart </b></label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="UIContainer" style="text-align: left; background-color: rgba(35, 54, 75, 0.9); border-radius: 5px;">
                            <div style="text-align: center; font-size: 32px; color: white;">
                                <p>
                                    MODIFIERS
                                </p>
                            </div>
                            <hr>
                            <div style="margin-left: 10px;">
                                <input id="OptionModAuto" onchange="Reload_Chart(this)" type="checkbox"> <label>Auto</label> <br>

                                <input id="OptionModRate" onchange="Reload_Chart()" type="number" value="1" min="0.2" max="16" oninput="{
                                    document.getElementById('OptionModRateSlider').value = this.value * 20;}" style="width: 2.375rem;">
                                <input id="OptionModRateSlider" onchange="Reload_Chart()" type="range" min="4" max="320" value="20" class="slider" id="myRange" oninput="{
                                    document.getElementById('OptionModRate').value = this.value / 20}" style="width: 50%"> <label>Rate</label> <br>

                                <input id="OptionSwitcher" onchange="Reload_Chart()" type="checkbox"> <label>Switcher</label> <br>
                            </div>
                        </div>
                    </div>
                    <div style="width: 45%; height: auto;">
                        <div class="UIContainer" style="text-align: left; background-color: rgba(35, 54, 75, 0.9); border-radius: 5px; ">
                            <div style="text-align: center; font-size: 32px; color: white;">
                                <p>
                                    GAMEPLAY
                                </p>
                            </div>
                            <hr>
                            <div style="margin-left: 10px;">
                                <input id="OptionUpscroll" onchange="SaveOptions()" type="checkbox"> <label>Upscroll</label> <br>
                                <input id="OptionScrollSpeed" onchange="SaveOptions()" type="number" value="15"> <label>Scroll Speed</label> <br>
                                <input id="OptionPlayfieldXOffset" onchange="SaveOptions()" type="number" value="366"> <label>Playfield X Offset</label> <br>
                                <input id="OptionBackgroundDim" onchange="Reload_Chart()" type="number" value="50" min="0" max="100" oninput="{
                                    document.getElementById('OptionBGDim').value = this.value;
                                    document.getElementById('BGContainer').style.backgroundColor = 'rgba(0, 0, 0, ' + this.value / 100 + ')';}" style="width: 2.375rem;">
                                <input id="OptionBGDim" oninput="{
                                    document.getElementById('OptionBackgroundDim').value = this.value;
                                    document.getElementById('BGContainer').style.backgroundColor = 'rgba(0, 0, 0, ' + this.value / 100 + ')';}" type="range" min="1" max="100" value="50" style="width: 50%;"> <label>Background Dim</label>
                                <br>
                            </div>
                        </div>
                        <div class="UIContainer" style="text-align: left; background-color: rgba(35, 54, 75, 0.9); border-radius: 5px;">
                            <div style="text-align: center; font-size: 32px; color: white;">
                                <p>
                                    INFORMATION
                                </p>
                            </div>
                            <hr>
                            <div>
                                <div style="text-align: center; font-size: 28px; color: white;">
                                    <p>
                                        Join our discord!!
                                    </p>
                                </div>
                                <div style="color: white; margin-left: 20px">
                                    <a>
                                        Joining the discord helps increase activity, development, and events.
                                    </a>
                                    <br>
                                    <a>
                                        It also allows users to recommend features like QoL improvements and new ideas entirel, or you could report bugs you find, .
                                    </a>
                                    <br>
                                    <a>
                                       You can keep updated on what is happening in the community.
                                    </a>
                                    <br>
                                    <a>
                                        If you're looking for a project to help in. This project is open source. <a href="https://github.com/Crypto-Path/Aria-Engine-Prosody">Github</a>
                                    </a>
                                </div>
                            </div>
                            <div>
                                <div class="UIContainer">
                                    <iframe src="https://discord.com/widget?id=1082208425582276700&theme=dark" width="66%" height="400" style="margin-left: 16.6%" allowtransparency="true" frameborder="0" sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <button style="width: 90px; height: 40px; background-color: rgba(255, 255, 255, 0.77); border-radius: 5px;" onclick="{document.getElementById('MainPanel').style.display = 'none'}">
                    CONTINUE
                    </button>
                </div>
            </div>
        </div>

        <script>
            const rangeInput = document.getElementById('OptionModRate');

            // Listen for keydown event on the document
            document.addEventListener('keydown', (event) => {
                if (event.ctrlKey && event.shiftKey && event.key === '+') {
                    // Move the range to the right
                    rangeInput.value = Math.round((parseFloat(rangeInput.value) + 0.05) * 20) / 20;
                    document.getElementById('OptionModRateSlider').value = document.getElementById('OptionModRate').value * 20;
                    document.getElementById('OptionModRate').value = parseInt(document.getElementById('OptionModRateSlider').value) / 20;
                    Reload_Chart()
                    event.preventDefault(); // Prevent default browser behavior
                    return;
                }
                if (event.ctrlKey && event.shiftKey && event.key === '_') {
                    // Move the range to the right
                    rangeInput.value = Math.round((parseFloat(rangeInput.value) - 0.05) * 20) / 20;
                    document.getElementById('OptionModRateSlider').value = document.getElementById('OptionModRate').value * 20;
                    document.getElementById('OptionModRate').value = parseInt(document.getElementById('OptionModRateSlider').value) / 20;
                    Reload_Chart()
                    event.preventDefault(); // Prevent default browser behavior
                    return;
                }

                if (event.ctrlKey && event.key === '=') {
                    // Move the range to the right
                    rangeInput.value = Math.round((parseFloat(rangeInput.value) + 0.1) * 20) / 20;
                    document.getElementById('OptionModRateSlider').value = document.getElementById('OptionModRate').value * 20;
                    document.getElementById('OptionModRate').value = parseInt(document.getElementById('OptionModRateSlider').value) / 20;
                    Reload_Chart()
                    event.preventDefault(); // Prevent default browser behavior
                    return;
                }

                // Check if Ctrl key and - are pressed
                if (event.ctrlKey && event.key === '-') {
                    // Move the range to the left
                    rangeInput.value = Math.round((parseFloat(rangeInput.value) - 0.1) * 20) / 20;
                    document.getElementById('OptionModRateSlider').value = document.getElementById('OptionModRate').value * 20;
                    document.getElementById('OptionModRate').value = parseInt(document.getElementById('OptionModRateSlider').value) / 20;
                    Reload_Chart()
                    event.preventDefault(); // Prevent default browser behavior
                    return;
                }
            });
        </script>
        <div id="ProgressBarContainer" style="position: fixed; bottom: 0; left: 0; width: 100%; height: 5px; background-color: #ccc; z-index: 999;">
            <div id="ProgressBar" style="width: 0; height: 100%;background-color: #00aaff;">
            </div>
        </div>
        <div id="BGContainer" style="position:absolute; background-color: rgba(0, 0, 0, 0.5); z-index: -5; width: 100% !important; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center;">
            <img id="BGDim" class="background" style="position: absolute; z-index: -7; margin: 0 auto; width: 100%; background-color: inherit;" src="Sprites/Background/Dim.png" />
            <img id="BGCenter" class="background" style="position: absolute; z-index: -8; margin: 0 auto; width: 80%;" />
            <img id="BGPattern" class="background" style="position: absolute; z-index: -9; margin: 0 auto; width: 120%;" />
            <img id="BGGradient" class="background" style="position: absolute; z-index: -10; margin: 0 auto; width: 100%;" />
        </div>
</body>

</html>