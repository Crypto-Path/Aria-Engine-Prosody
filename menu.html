<html> 
    <head>
        <title>
            Prosody - Menu
        </title>
        <link rel="stylesheet" href="CSS/UI.css">
        <link rel="stylesheet" href="CSS/BG.css">
        <style>
            a {
                font-size: 1rem;
            }

            p {
                font-size: 1rem;
            }

            .SongSelector {
                display: block;
                background-color: rgba(0, 0, 0, 0.5);
                width: 100%;
                cursor: pointer;
            }
            .SongSelector:hover {
                background-color: rgba(0, 0, 0, 0.75);
            }

            .miniIcon {
                background-color: rgba(62, 86, 114, 0.5);
                border-radius: 15%;
                width: 0.875rem;
            }

            .SongBanner {
                background-image: url('Sprites/Background/BG.png');
                background-size: 100%;
                height: 6rem;
                background-position: center;
                text-align: left;
                border-radius: 0 0 1rem 1rem;
            }

            .BannerImg {
                margin-top: 2rem;
            }

            ::-webkit-scrollbar {
                -webkit-appearance: scrollbartrack-vertical;
                -webkit-appearance: scrollbarthumb-vertical;
            }   

            .chartContainer {
                display: flex; overflow-wrap: break-word; flex-direction: row; flex-wrap: wrap; overflow-y: scroll;height: auto;
            }

            .big {
                font-size: 2rem;
            }

            .tag {
                background-color: rgba(0, 0, 0, 0.2);
                border-radius: 25%;
                margin: 2px;
            }

            .tab {
                color: lightskyblue;
                text-decoration: underline;
                cursor:pointer;
            }
        </style>
        </head>
        <body>
        <div class="UIContainer" style="width: 25%; background-color: rgba(0, 0, 0, 0);">
            <div style="width: 100%; height: 20%;">
                <img id="InfoBanner" style="width: 100%; aspect-ratio : 16 / 9; border-radius: 10px;" src="Sprites/Game.png"/>
                <a id="Title" class="big">
                    Prosody
                </a>
            </div> 
            <audio id="audio" style="position:sticky;top: 200%; float: left; display:none" controls></audio><br>
        </div>
        <div style="width: 20%; display: flex; top: 37%; margin-left: 2rem; justify-content: space-evenly;">
            <a class="tab" onclick="{document.getElementById('InfoPanel').style.display = 'block';document.getElementById('ScoresPanel').style.display = 'none';document.getElementById('AboutPanel').style.display = 'block';}">Basic</a>
            <a class="tab" onclick="{document.getElementById('InfoPanel').style.display = 'none';document.getElementById('ScoresPanel').style.display = 'none';document.getElementById('AboutPanel').style.display = 'block';}">About</a>
            <a class="tab" onclick="{document.getElementById('InfoPanel').style.display = 'block';document.getElementById('ScoresPanel').style.display = 'none';document.getElementById('AboutPanel').style.display = 'none';}">Info</a>
            <a class="tab" onclick="{document.getElementById('InfoPanel').style.display = 'none';document.getElementById('ScoresPanel').style.display = 'block';document.getElementById('AboutPanel').style.display = 'none';}">Leaderboard</a>
        </div>
        <div  class="UIContainer" style="width: 20%; height: auto; top: 38%; padding-top: 5px; ">
            <div id="AboutPanel" style="display: block;">
                <div class="UIContainer">
                    <a>
                        Description:
                    </a>
                    <p id = "description">
                        Just a simple browser rhythm game
                    </p>
                </div>
                <div class="UIContainer" style="overflow-wrap:normal;">
                    <a>
                        Tags:
                    </a>
                    <br><br>
                    <div id="TagContainer">
                        <a class="tag">Prosody </a><a class="tag">4K </a><a class="tag">4Key </a><a class="tag">VSRG </a><a class="tag">Vertical </a><a class="tag">Scrolling </a><a class="tag">Rhythm </a><a class="tag">Game </a>
                    </div>
                </div>
            </div>
            <div id="InfoPanel" style="display: block;">
                <div class="UIContainer" style="overflow-wrap:normal;">
                    <br>
                    <a>
                        Difficulty: 
                    </a>
                    <a id="ChartDifficulty">
                        ∞
                    </a>
                    <br><br>
                    <a>
                        Max combo: 
                    </a>
                    <a id="ChartTTNotes">
                        ∞
                    </a>
                    <br><br>
                    <a>
                        BPM: 
                    </a>
                    <a id="ChartBPM">
                        ∞
                    </a>
                    <br><br>
                    <a>
                        NPS: 
                    </a>
                    <a id="ChartNPS">
                        ∞
                    </a>
                </div>
                <div class="UIContainer" style="overflow-wrap:normal;">
                    <a>
                        Artist:
                    </a>
                    <br>
                    <a>
                        Creator:
                    </a>
                </div>
            </div>
            <div id="ScoresPanel" style="display: none;">
                WORK IN PROGRESS
                <br>
                <a style="font-size: 0.66rem;">
                    Currently only shows contributers to the development of prosody. (Likely not up to date, this is just a placeholder for now)
                </a>
                <div class="UIContainer">
                    <div class="score">
                        <a>
                            Cyphe Mercury
                        </a>
                        <br>
                        <a style="font-size: 0.7rem;">
                            Score: [Lead developer]<br>Accuracy: [Mainly weekends]<br>Value: [UX/UI, Art, Music, Script, Gameplay, Charter]
                        </a>
                    </div>
                    <div class="score">
                        <a>
                            Inaji
                        </a>
                        <br>
                        <a style="font-size: 0.7rem;">
                            Score: [Producer]<br>Accuracy: [The Pathbreaking]<br>Value: [Music]
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <script src="Data/Maps.js"></script>
        <div class="bg"></div>
        <div class="bg bg2"></div>
        <div class="bg bg3"></div>
        </div>
        <div id="Container" class = "UIContainer" style="background-color: rgba(0, 0, 0, 0) ; position: absolute; height: 95%; width: 37%; right: 0; top: 0;">
            <div id="TitleMenuContainer" class="UIContainer">
                <input type="text" style="width: 75%; height: 2rem; font-size: 22px;" placeholder="Work In Progress" /> <br>
                <button>
                    Search
                </button>
            </div>
            <div id="SongsContainer" class="UIContainer chartContainer" style="background-color: rgba(0, 0, 0, 0)">
            </div>
        </div>
        
        <div id="BGContainer" style="position:absolute; top: 0; background-color: rgba(0, 0, 0, 0.65); z-index: -5; width: 100% !important; height: 100%; display: none; flex-direction: column; justify-content: center; align-items: center;">
            <img id="BGDim" class="background" style="position: absolute; z-index: -7; margin: 0 auto; width: 100%; background-color: inherit;" src="Sprites/Background/Dim.png" />
            <img id="BGImage" class="background" style="position: absolute; z-index: -10; margin: 0 auto; width: 100%; filter: blur(8px);" src="Sprites/Background/BG.png"/>
        <script src = "Scripts/statCalculations.js" ></script>
        <script src="Scripts/DifficultyCalculator.js"></script>
        <script>

            // function CreateButton(_mapId) {
            //     console.log(`Loading map: ${_mapId}`)
            //     var main = document.createElement("button")

            //     var banner = document.createElement("div")
            //     var bannerImg = document.createElement("img")
            //     var bannerTitle = document.createElement("a")
                
            //     var info = document.createElement("div")
            //     var infoStats = document.createElement("p")

            //     info.appendChild(infoStats);

            //     banner.appendChild(bannerImg);
            //     banner.appendChild(bannerTitle);

            //     main.appendChild(banner);
            //     main.appendChild(info);

            //     main.classList.add("UIContainer")
            //     main.classList.add("SongSelector")
            //     main.onclick = function name(params) {
            //         localStorage['Chart'] = JSON.stringify(charts[_mapId])
            //         window.location.href='game.html'
            //     }

            //     banner.classList.add("SongBanner", "UIContainer")
            //     bannerImg.classList.add("BannerImg")

            //     bannerImg.src = "Sprites/Icon.png";
            //     bannerTitle.innerText = charts[_mapId]["Name"]

            //     var au = document.createElement('audio');
            //     au.src = charts[_mapId]["Audio"]
            //     au.addEventListener('loadedmetadata', function(){
            //         infoStats.innerHTML = `Length: ${Math.floor(au.duration/60)}:${(au.duration % 60 < 10) ? '0' : ''}${Math.floor(au.duration % 60)}` + "<br>Difficulty: WIP<br>Score: 1000000 <img src='Sprites/Ranks/Rank_PC+.png' class='miniIcon'> <img src='Sprites/Ranks/Rank_EX.png' class='miniIcon'>"
            //     })

            //     info.classList.add("UIContainer")

            //     document.getElementById("SongsContainer").appendChild(main);
            // }

            function CreateButton(_mapId) {
                console.log(`Loading map: ${_mapId}`)
                var main = document.createElement("button")
                
                var info = document.createElement("div")
                var title = document.createElement("a")
                var other = document.createElement("a")

                main.appendChild(info);
                info.appendChild(title);
                info.appendChild(other);

                other.style.fontSize = "0.66rem"
                
                main.classList.add("UIContainer")
                main.classList.add("SongSelector")
                main.onclick = function name(params) {
                    document.getElementById("BGContainer").style.display = "flex";
                    document.querySelectorAll('.bg').forEach(e => e.remove());
                    this.style.backgroundColor = "rgba(127,127,127,127.2)"
                    if(this.id == "Selected") {
                        localStorage['Chart'] = JSON.stringify(charts[_mapId])
                        window.location.href='game.html'
                    }
                    try {
                        let Deselect = document.getElementById("Selected")
                        Deselect.id = ""
                        Deselect.style.backgroundColor = "rgba(0,0,0,0.5)"
                    } catch (error) { }
                    this.id = "Selected"
                    document.getElementById("BGImage").src = charts[_mapId]["BG"]["BG"]
                    document.getElementById("InfoBanner").src = charts[_mapId]["BG"]["BG"]
                    document.getElementById("Title").innerText = charts[_mapId]["Name"]

                    // SECTION: Audio

                    document.getElementById("audio").src = charts[_mapId]["Audio"];
                    document.getElementById("audio").currentTime = charts[_mapId]["4Rows"]["Difficulty1"]["PreviewPoint"]
                    document.getElementById("audio").play()

                    document.getElementById("audio").onended = () => {
                        setTimeout(() => {
                            document.getElementById("audio").currentTime = charts[_mapId]["4Rows"]["Difficulty1"]["PreviewPoint"];
                            document.getElementById("audio").play()
                        },500)
                    }

                    // SECTION: Difficulty stats

                    document.getElementById("audio").oncanplay = () => {
                        totalNotes = charts[_mapId]["4Rows"]["Difficulty1"]["Notes"][0].length+charts[_mapId]["4Rows"]["Difficulty1"]["Notes"][1].length+charts[_mapId]["4Rows"]["Difficulty1"]["Notes"][2].length+charts[_mapId]["4Rows"]["Difficulty1"]["Notes"][3].length
                        document.getElementById("ChartDifficulty").innerText = Math.round(calculateDifficulty(charts[_mapId]) * 100) / 100
                        document.getElementById("ChartTTNotes").innerText = totalNotes
                        document.getElementById("ChartBPM").innerText = charts[_mapId]["BPM"]
                        document.getElementById("ChartNPS").innerText = Math.round(totalNotes / document.getElementById("audio").duration * 10) / 10
                    }

                    // SECTION: Description

                    const Desc = charts[_mapId]["Description"]
                    document.getElementById("description").innerText = (Desc != undefined) ? Desc : "This chart does not have a description!";
                    
                    // SECTION: Tags
                    var tags = document.getElementsByClassName('tag');

                    while(tags[0]) {
                        tags[0].parentNode.removeChild(tags[0]);
                    }

                    for (let i = 0; i < charts[_mapId]["Tags"].length; i++) {
                        
                        const element = charts[_mapId]["Tags"][i];

                        let tag = document.createElement("a");
                        tag.innerText = element;
                        tag.classList.add("tag")

                        document.getElementById("TagContainer").appendChild(tag);
                    }
                }
                title.innerText = charts[_mapId]["Name"];
                other.innerText = `\nArtist: ${charts[_mapId]["SongArtist"]}, By: ${charts[_mapId]["Creator"]}`

                //info.classList.add("UIContainer")

                document.getElementById("SongsContainer").appendChild(main);

            }

            for (var i in charts) {
                CreateButton(i)
            }
        </script>
        <script>
            function getRandomInt(_max) {
                return Math.floor(Math.random() * _max);
            }

            function IncDecRementSelection(_dir) {
                try {
                    (_dir == 1) ? document.getElementById('Selected').nextSibling.click() : document.getElementById('Selected').previousSibling.click()
                } catch (error) {
                    (_dir == 1) ? document.getElementById("SongsContainer").children[0].click() : document.getElementById("SongsContainer").children[document.getElementById("SongsContainer").children.length-1].click()
                    // if (document.getElementById("SongsContainer").children[getRandomInt(document.getElementById("SongsContainer").children.length)] != document.getElementById("Selected")) {
                    //     document.getElementById("SongsContainer").children[getRandomInt(document.getElementById("SongsContainer").children.length)].click()
                    // }
                }
            }
        </script>
        <script>


            window.onkeydown = function(e) {
                switch (e.keyCode) {
                    case 27: 
                        location.href = 'index.html';
                        break;
                    case 37: // Move selection up
                        IncDecRementSelection(-1)
                        break;
                    case 38: // Move selection up
                        IncDecRementSelection(-1)
                        break;
                    case 39: // Move selection down
                        IncDecRementSelection(1)
                        break;
                    case 40: // Move selection down
                        IncDecRementSelection(1)
                        break;
                    case 13: // Move selection down
                        document.getElementById('Selected').click()
                        break;
                
                    default:
                        console.log(e.keyCode)
                        break;
                }
            }
        </script>
    </body>
</html>